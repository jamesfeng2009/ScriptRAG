# RAG Screenplay Multi-Agent System

åŸºäº RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çš„å‰§æœ¬ç”Ÿæˆå¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼Œä½¿ç”¨ LangGraph ç¼–æ’å…­ä¸ªä¸“é—¨çš„æ™ºèƒ½ä½“ååŒå·¥ä½œï¼Œç”ŸæˆåŸºäºå®é™…é¡¹ç›®ä»£ç å’Œæ–‡æ¡£çš„æŠ€æœ¯å‰§æœ¬ã€‚

## æ ¸å¿ƒç‰¹æ€§

- **å¤šæ™ºèƒ½ä½“åä½œæ¶æ„**: å…­ä¸ªä¸“é—¨æ™ºèƒ½ä½“åˆ†å·¥åä½œï¼ˆè§„åˆ’å™¨ã€å¯¼èˆªå™¨ã€å¯¼æ¼”ã€è½¬å‘ç®¡ç†å™¨ã€ç¼–å‰§ã€ç¼–è¯‘å™¨ï¼‰
- **RAG æ··åˆæ£€ç´¢**: ç»“åˆå‘é‡æœç´¢å’Œå…³é”®è¯åŒ¹é…çš„æ™ºèƒ½æ£€ç´¢
- **å¤š LLM æä¾›å•†æ”¯æŒ**: OpenAIã€é€šä¹‰åƒé—®ã€MiniMaxã€æ™ºè°± GLMï¼Œæ”¯æŒè‡ªåŠ¨å›é€€
- **åŠ¨æ€ Skill ç³»ç»Ÿ**: å…­ç§ç”Ÿæˆé£æ ¼ï¼ˆæ ‡å‡†æ•™ç¨‹ã€è­¦å‘Šæ¨¡å¼ã€å¯è§†åŒ–ç±»æ¯”ã€ç ”ç©¶æ¨¡å¼ã€è½»æ¾é£æ ¼ã€å›é€€æ‘˜è¦ï¼‰
- **Task Stack ä»»åŠ¡ç®¡ç†**: æ”¯æŒé€’å½’ä»»åŠ¡åˆ†è§£å’ŒåµŒå¥—ä»»åŠ¡ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œå¯é…ç½®æœ€å¤§æ·±åº¦
- **äº‹å®æ£€æŸ¥æœºåˆ¶**: å¹»è§‰æ£€æµ‹å’Œé˜²å¾¡ï¼Œç¡®ä¿å†…å®¹åŸºäºçœŸå®æ¥æº
- **å•†ä¸šåŒ–å°±ç»ª**: ä¼ä¸šçº§åˆ†å±‚æ¶æ„ï¼Œæ”¯æŒå¤šç§Ÿæˆ·å’Œæ°´å¹³æ‰©å±•
- **ä¼˜é›…é™çº§**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¶…æ—¶ä¿æŠ¤æœºåˆ¶

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·è¾“å…¥                                  â”‚
â”‚                  (ä¸»é¢˜ + é¡¹ç›®ä¸Šä¸‹æ–‡)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LangGraph çŠ¶æ€æœº                             â”‚
â”‚                 (WorkflowOrchestrator)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼            â–¼            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚è§„åˆ’å™¨  â”‚  â”‚å¯¼èˆªå™¨  â”‚  â”‚å¯¼æ¼”    â”‚
   â”‚Planner â”‚  â”‚Navigatorâ”‚ â”‚Directorâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚
        â”‚            â–¼            â–¼
        â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚è½¬å‘ç®¡ç†â”‚  â”‚ç¼–å‰§    â”‚
        â”‚      â”‚Pivot   â”‚  â”‚Writer  â”‚
        â”‚      â”‚Manager â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
        â”‚            â”‚           â–¼
        â”‚            â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚      â”‚äº‹å®æ£€æŸ¥â”‚
        â”‚            â”‚      â”‚Fact    â”‚
        â”‚            â”‚      â”‚Checker â”‚
        â”‚            â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                                        â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ç¼–è¯‘å™¨  â”‚
                                  â”‚Compilerâ”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚æœ€ç»ˆå‰§æœ¬  â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚æ¶æ„

ç³»ç»Ÿé‡‡ç”¨ä¼ä¸šçº§åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œç¡®ä¿å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œå•†ä¸šåŒ–éƒ¨ç½²ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡¨ç¤ºå±‚ (Presentation Layer)                                  â”‚
â”‚  - CLI æ¥å£ã€REST APIã€Web UIã€ç›‘æ§ä»ªè¡¨æ¿                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨å±‚ (Application Layer)                                   â”‚
â”‚  - LangGraph å·¥ä½œæµç¼–æ’ã€æ™ºèƒ½ä½“åè°ƒå™¨ã€ä»»åŠ¡è°ƒåº¦ã€ä¼šè¯ç®¡ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)                            â”‚
â”‚  - å…­å¤§æ ¸å¿ƒæ™ºèƒ½ä½“ã€Skill ç®¡ç†å™¨ã€äº‹å®æ£€æŸ¥å™¨ã€å†²çªè§£å†³å™¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœåŠ¡å±‚ (Service Layer)                                       â”‚
â”‚  - LLM æœåŠ¡ã€å‘é‡æ•°æ®åº“æœåŠ¡ã€ä»£ç è§£ææœåŠ¡ã€æ‘˜è¦æœåŠ¡            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®è®¿é—®å±‚ (Data Access Layer)                               â”‚
â”‚  - PostgreSQL + pgvectorã€Redis ç¼“å­˜ã€MinIO å¯¹è±¡å­˜å‚¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)                            â”‚
â”‚  - æ—¥å¿—ç³»ç»Ÿã€ç›‘æ§è¿½è¸ªã€é”™è¯¯å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ presentation/          # è¡¨ç¤ºå±‚ï¼šCLIã€API æ¥å£
â”œâ”€â”€ application/          # åº”ç”¨å±‚ï¼šå·¥ä½œæµç¼–æ’
â”‚   â””â”€â”€ orchestrator.py   # LangGraph çŠ¶æ€æœºç®¡ç†
â”œâ”€â”€ domain/              # ä¸šåŠ¡é€»è¾‘å±‚ï¼šæ™ºèƒ½ä½“ã€æ¨¡å‹ã€æŠ€èƒ½
â”‚   â”œâ”€â”€ agents/          # å…­å¤§æ™ºèƒ½ä½“å®ç°
â”‚   â”‚   â”œâ”€â”€ task_aware_planner.py  # è§„åˆ’å™¨ï¼šç”Ÿæˆåˆå§‹å¤§çº²ï¼ˆæ”¯æŒ Task Stackï¼‰
â”‚   â”‚   â”œâ”€â”€ navigator.py        # å¯¼èˆªå™¨ï¼šRAG æ£€ç´¢
â”‚   â”‚   â”œâ”€â”€ director.py         # å¯¼æ¼”ï¼šè¯„ä¼°å’Œå†³ç­–
â”‚   â”‚   â”œâ”€â”€ pivot_manager.py    # è½¬å‘ç®¡ç†å™¨ï¼šä¿®æ­£å¤§çº²
â”‚   â”‚   â”œâ”€â”€ writer.py           # ç¼–å‰§ï¼šç”Ÿæˆå‰§æœ¬ç‰‡æ®µ
â”‚   â”‚   â”œâ”€â”€ compiler.py         # ç¼–è¯‘å™¨ï¼šæ•´åˆæœ€ç»ˆå‰§æœ¬
â”‚   â”‚   â”œâ”€â”€ fact_checker.py     # äº‹å®æ£€æŸ¥å™¨ï¼šéªŒè¯å†…å®¹
â”‚   â”‚   â””â”€â”€ retry_protection.py # é‡è¯•ä¿æŠ¤ï¼šé˜²æ­¢æ— é™å¾ªç¯
â”‚   â”œâ”€â”€ task_stack.py      # Task Stackï¼šåµŒå¥—ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ models.py        # æ•°æ®æ¨¡å‹ï¼ˆGlobalStateã€OutlineStep ç­‰ï¼‰
â”‚   â””â”€â”€ skills.py        # Skill ç³»ç»Ÿé…ç½®
â”œâ”€â”€ services/            # æœåŠ¡å±‚ï¼šå¤–éƒ¨æœåŠ¡é›†æˆ
â”‚   â”œâ”€â”€ llm/            # LLM æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ service.py          # ç»Ÿä¸€ LLM æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ adapter.py          # LLM é€‚é…å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ openai_adapter.py   # OpenAI é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ qwen_adapter.py     # é€šä¹‰åƒé—®é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ minimax_adapter.py  # MiniMax é€‚é…å™¨
â”‚   â”‚   â””â”€â”€ glm_adapter.py      # æ™ºè°± GLM é€‚é…å™¨
â”‚   â”œâ”€â”€ database/       # æ•°æ®åº“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ postgres.py         # PostgreSQL è¿æ¥
â”‚   â”‚   â”œâ”€â”€ vector_db.py        # å‘é‡æ•°æ®åº“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ redis_cache.py      # Redis ç¼“å­˜
â”‚   â”‚   â””â”€â”€ logging_db.py       # æ—¥å¿—æŒä¹…åŒ–
â”‚   â”œâ”€â”€ parser/         # ä»£ç è§£ææœåŠ¡
â”‚   â”‚   â””â”€â”€ tree_sitter_parser.py  # Tree-sitter è§£æå™¨
â”‚   â”œâ”€â”€ retrieval_service.py    # æ£€ç´¢æœåŠ¡
â”‚   â””â”€â”€ summarization_service.py # æ‘˜è¦æœåŠ¡
â””â”€â”€ infrastructure/      # åŸºç¡€è®¾æ–½å±‚ï¼šæ¨ªåˆ‡å…³æ³¨ç‚¹
    â”œâ”€â”€ logging.py       # æ—¥å¿—ç³»ç»Ÿ
    â”œâ”€â”€ monitoring.py    # ç›‘æ§è¿½è¸ª
    â””â”€â”€ error_handler.py # é”™è¯¯å¤„ç†å’Œä¼˜é›…é™çº§
```

## æ ¸å¿ƒå®ç°æ€è·¯

### 1. å¯¼æ¼”é©±åŠ¨å¾ªç¯ï¼ˆDirector-Driven Loopï¼‰

ç³»ç»Ÿé‡‡ç”¨ç‹¬ç‰¹çš„"å¯¼æ¼”é©±åŠ¨å¾ªç¯"æ¨¡å¼ï¼Œè€Œéç®€å•çš„çº¿æ€§æµç¨‹ï¼š

```
ç”¨æˆ·è¾“å…¥ â†’ è§„åˆ’å™¨ç”Ÿæˆå¤§çº² â†’ å¾ªç¯å¤„ç†æ¯ä¸ªæ­¥éª¤ï¼š
    â”œâ”€ å¯¼èˆªå™¨æ£€ç´¢ç›¸å…³å†…å®¹
    â”œâ”€ å¯¼æ¼”è¯„ä¼°å†…å®¹è´¨é‡
    â”‚   â”œâ”€ å‘ç°å†²çªï¼Ÿâ†’ è½¬å‘ç®¡ç†å™¨ä¿®æ­£å¤§çº² â†’ é‡æ–°æ£€ç´¢
    â”‚   â”œâ”€ å†…å®¹å¤æ‚ï¼Ÿâ†’ åˆ‡æ¢ Skillï¼ˆå¦‚å¯è§†åŒ–ç±»æ¯”ï¼‰
    â”‚   â””â”€ æ‰¹å‡†ï¼Ÿâ†’ ç¼–å‰§ç”Ÿæˆç‰‡æ®µ
    â”œâ”€ äº‹å®æ£€æŸ¥å™¨éªŒè¯ç‰‡æ®µ
    â”‚   â”œâ”€ æœ‰å¹»è§‰ï¼Ÿâ†’ é‡æ–°ç”Ÿæˆ
    â”‚   â””â”€ æœ‰æ•ˆï¼Ÿâ†’ ç»§ç»­ä¸‹ä¸€æ­¥
    â””â”€ æ‰€æœ‰æ­¥éª¤å®Œæˆ â†’ ç¼–è¯‘å™¨æ•´åˆæœ€ç»ˆå‰§æœ¬
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **è‡ªé€‚åº”è°ƒæ•´**ï¼šå¯¼æ¼”å¯ä»¥æ ¹æ®æ£€ç´¢å†…å®¹åŠ¨æ€è°ƒæ•´ç­–ç•¥
- **è´¨é‡ä¿è¯**ï¼šå¤šé‡æ£€æŸ¥æœºåˆ¶ï¼ˆå†²çªæ£€æµ‹ã€äº‹å®éªŒè¯ï¼‰
- **ä¼˜é›…é™çº§**ï¼šé‡åˆ°é—®é¢˜æ—¶è‡ªåŠ¨åˆ‡æ¢ç­–ç•¥è€Œéå¤±è´¥

### 2. RAG æ··åˆæ£€ç´¢ç­–ç•¥

å¯¼èˆªå™¨æ™ºèƒ½ä½“å®ç°äº†åˆ›æ–°çš„æ··åˆæ£€ç´¢æ–¹æ³•ï¼š

```python
# å‘é‡æœç´¢ï¼ˆè¯­ä¹‰ç›¸ä¼¼åº¦ï¼‰
vector_results = search_by_embedding(query_embedding, top_k=5)

# å…³é”®è¯æœç´¢ï¼ˆæ•æ„Ÿæ ‡è®°ï¼‰
keyword_results = search_by_markers(
    markers=["@deprecated", "FIXME", "TODO", "Security"]
)

# åŠ æƒåˆå¹¶
final_results = merge_with_weights(
    vector_results, weight=0.6,
    keyword_results, weight=0.4,
    boost_factor=1.5  # æ•æ„Ÿæ ‡è®°å‘½ä¸­æ—¶åŠ æƒ
)
```

**æŠ€æœ¯æ ˆ**ï¼š
- **åˆæœŸ**ï¼šPostgreSQL 17 + pgvectorï¼ˆç»Ÿä¸€æ•°æ®åº“ï¼Œé™ä½è¿ç»´å¤æ‚åº¦ï¼‰
- **æ‰©å±•**ï¼šå½“å‘é‡æ•°æ®é‡ > 100 ä¸‡æˆ– QPS > 100 æ—¶ï¼Œè¿ç§»åˆ° Milvus

### 3. åŠ¨æ€ Skill ç³»ç»Ÿ

å…­ç§ç”Ÿæˆé£æ ¼é€‚åº”ä¸åŒåœºæ™¯ï¼š

| Skill | ä½¿ç”¨åœºæ™¯ | è¯­è°ƒ |
|-------|---------|------|
| `standard_tutorial` | æ ‡å‡†æ•™ç¨‹ | ä¸“ä¸šã€æ­£å¼ |
| `warning_mode` | åºŸå¼ƒåŠŸèƒ½ã€å®‰å…¨é—®é¢˜ | è­¦ç¤ºã€è°¨æ… |
| `visualization_analogy` | å¤æ‚æ¦‚å¿µ | ç”ŸåŠ¨ã€æ˜“æ‡‚ |
| `research_mode` | ä¿¡æ¯ä¸è¶³ | æ¢ç´¢æ€§ |
| `meme_style` | è½»æ¾å†…å®¹ | å¹½é»˜ã€éšæ„ |
| `fallback_summary` | é™çº§æ¨¡å¼ | ä¸­æ€§ã€ç®€æ´ |

**Skill å…¼å®¹æ€§è§„åˆ™**ï¼š
```
standard_tutorial â†” visualization_analogy
standard_tutorial â†” warning_mode
warning_mode â†” research_mode
visualization_analogy â†” meme_style
meme_style â†” fallback_summary
fallback_summary â†” standard_tutorial
```

### 4. å¤š LLM æä¾›å•†æ¶æ„

ç»Ÿä¸€é€‚é…å™¨æ¥å£ + è‡ªåŠ¨å›é€€æœºåˆ¶ï¼š

```python
# é…ç½®ç¤ºä¾‹
LLM_CONFIG = {
    "active_provider": "openai",
    "fallback_providers": ["qwen", "glm"],
    "model_mappings": {
        "openai": {
            "high_performance": "gpt-4o",      # è§„åˆ’å™¨ã€å¯¼æ¼”
            "lightweight": "gpt-4o-mini",      # ç¼–å‰§ã€ç¼–è¯‘å™¨
            "embedding": "text-embedding-3-large"
        }
    }
}
```

**è‡ªåŠ¨å›é€€æµç¨‹**ï¼š
1. ä¸»æä¾›å•†è°ƒç”¨å¤±è´¥ï¼ˆé€Ÿç‡é™åˆ¶ã€API é”™è¯¯ï¼‰
2. ä½¿ç”¨æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
3. ä»å¤±è´¥ï¼Ÿè‡ªåŠ¨åˆ‡æ¢åˆ°å›é€€æä¾›å•†
4. è®°å½•æ‰€æœ‰åˆ‡æ¢äº‹ä»¶åˆ°æ—¥å¿—

### 5. äº‹å®æ£€æŸ¥å’Œå¹»è§‰é˜²å¾¡

ä¸‰å±‚é˜²å¾¡æœºåˆ¶ï¼š

```
1. æ¥æºè¿½è¸ªï¼šæ‰€æœ‰é™ˆè¿°å¿…é¡»æ ‡æ³¨æ¥æº
   [æ¥æº: src/utils/helper.py]

2. LLM éªŒè¯ï¼šä½¿ç”¨é«˜æ€§èƒ½æ¨¡å‹äº¤å‰éªŒè¯
   - æ£€æµ‹ä¸å­˜åœ¨çš„å‡½æ•°ã€ç±»ã€å‚æ•°
   - å¯¹æ¯”ç‰‡æ®µä¸æºæ–‡æ¡£

3. å¯å‘å¼è§„åˆ™ï¼šæ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹æ˜æ˜¾é”™è¯¯
   - å‡½æ•°å®šä¹‰ï¼šdef function_name(
   - å‡½æ•°è°ƒç”¨ï¼š`function_name()`
   - ç±»å¼•ç”¨ï¼š`ClassName` ç±»
```

**å‘ç°å¹»è§‰æ—¶çš„å¤„ç†**ï¼š
- ç§»é™¤æ— æ•ˆç‰‡æ®µ
- å¢åŠ é‡è¯•è®¡æ•°å™¨
- é‡æ–°ç”Ÿæˆï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- è¶…è¿‡é™åˆ¶ï¼Ÿå¼ºåˆ¶é™çº§ï¼ˆè·³è¿‡æ­¥éª¤ï¼‰

### 6. é”™è¯¯å¤„ç†å’Œä¼˜é›…é™çº§

å®Œå–„çš„é”™è¯¯å¤„ç†ç­–ç•¥ï¼š

| é”™è¯¯ç±»å‹ | å¤„ç†ç­–ç•¥ | å›é€€è¡Œä¸º |
|---------|---------|---------|
| PostgreSQL è¿æ¥å¤±è´¥ | å›é€€åˆ°ä»…å…³é”®è¯æœç´¢ | è¿”å›ç©ºç»“æœ |
| åµŒå…¥ç”Ÿæˆå¤±è´¥ | è·³è¿‡å‘é‡æœç´¢ | ä½¿ç”¨å…³é”®è¯æœç´¢ |
| LLM é€Ÿç‡é™åˆ¶ | æŒ‡æ•°é€€é¿é‡è¯• | åˆ‡æ¢æä¾›å•† |
| äº‹å®æ£€æŸ¥å™¨å¤±è´¥ | è®°å½•è­¦å‘Š | å‡è®¾ç‰‡æ®µæœ‰æ•ˆ |
| æ‘˜è¦å™¨å¤±è´¥ | ä½¿ç”¨æˆªæ–­ | ä¿ç•™å‰ 10000 å­—ç¬¦ |
| ç¼–å‰§å¤±è´¥ | åˆ‡æ¢åˆ° fallback_summary | ç”Ÿæˆç®€å•æ¦‚è¿° |
| æ™ºèƒ½ä½“è¶…æ—¶ | è·³è¿‡æ­¥éª¤ | ç»§ç»­ä¸‹ä¸€æ­¥ |

**è¶…æ—¶é…ç½®**ï¼š
- è§„åˆ’å™¨/å¯¼èˆªå™¨/å¯¼æ¼”/ç¼–å‰§/äº‹å®æ£€æŸ¥å™¨/ç¼–è¯‘å™¨ï¼š60 ç§’
- è½¬å‘ç®¡ç†å™¨ï¼š30 ç§’
- é‡è¯•ä¿æŠ¤ï¼š10 ç§’

### 7. åŸºäºå±æ€§çš„æµ‹è¯•ï¼ˆProperty-Based Testingï¼‰

ä½¿ç”¨ Hypothesis æ¡†æ¶éªŒè¯ç³»ç»Ÿæ­£ç¡®æ€§ï¼š

```python
# å±æ€§ç¤ºä¾‹ï¼šçŠ¶æ€ä¿®æ”¹ä¸€è‡´æ€§
@given(state=shared_state_strategy())
def test_state_consistency(state):
    """ä»»ä½•æ™ºèƒ½ä½“ä¿®æ”¹çŠ¶æ€åï¼Œåç»­æ™ºèƒ½ä½“åº”èƒ½çœ‹åˆ°ä¿®æ”¹"""
    # ç”Ÿæˆ 100+ éšæœºæµ‹è¯•ç”¨ä¾‹
    assert all_agents_see_same_state(state)
```

**27 ä¸ªæ ¸å¿ƒå±æ€§ + 3 ä¸ªè¾¹ç•Œæƒ…å†µ**ï¼š
- çŠ¶æ€ä¸€è‡´æ€§ã€æ··åˆæ£€ç´¢å®Œæ•´æ€§ã€å¹»è§‰æ£€æµ‹
- é‡è¯•é™åˆ¶æ‰§è¡Œã€Skill å…¼å®¹æ€§ã€ä¼˜é›…é™çº§
- ç©ºæ£€ç´¢æ— å¹»è§‰ã€æœ€å¤§é‡è¯•è¾¹ç•Œã€Token é˜ˆå€¼è¾¹ç•Œ

### 8. Task Stack ä»»åŠ¡ç®¡ç†

è§„åˆ’å™¨æ™ºèƒ½ä½“æ”¯æŒå¯é€‰çš„ Task Stack åŠŸèƒ½ï¼Œç”¨äºç®¡ç†åµŒå¥—ä»»åŠ¡å’Œé€’å½’ä»»åŠ¡åˆ†è§£ï¼š

```python
# å¯ç”¨ Task Stack
factory = NodeFactory(
    llm_service=llm_service,
    retrieval_service=retrieval_service,
    parser_service=parser_service,
    summarization_service=summarization_service,
    use_task_stack=True,      # å¯ç”¨ Task Stack
    max_task_depth=5         # æœ€å¤§åµŒå¥—æ·±åº¦ï¼ˆé»˜è®¤ 3ï¼‰
)

# æˆ–é€šè¿‡ Orchestrator é…ç½®
orchestrator = WorkflowOrchestrator(
    llm_service=llm_service,
    enable_task_stack=True,
    max_task_depth=5
)
```

**Task Stack æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **åµŒå¥—ä»»åŠ¡ç®¡ç†**ï¼šæ”¯æŒé€’å½’åˆ†è§£å¤æ‚ä»»åŠ¡ä¸ºå­ä»»åŠ¡
- **ä¸Šä¸‹æ–‡éš”ç¦»**ï¼šæ¯ä¸ªä»»åŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡æ•°æ®
- **æ·±åº¦é™åˆ¶**ï¼šå¯é…ç½®çš„æœ€å¤§åµŒå¥—æ·±åº¦é˜²æ­¢æ— é™é€’å½’
- **ä»»åŠ¡è¿½æº¯**ï¼šæ”¯æŒè·å–å½“å‰ä»»åŠ¡ã€çˆ¶ä»»åŠ¡ã€ä»»åŠ¡æ·±åº¦ç­‰ä¿¡æ¯

**TaskStackManager API**ï¼š
```python
# åˆ›å»ºå­ä»»åŠ¡
state = planner.create_subtask(state, subtask_data)

# å®Œæˆå­ä»»åŠ¡ï¼ˆæ¢å¤çˆ¶ä»»åŠ¡ä¸Šä¸‹æ–‡ï¼‰
state, popped_context = planner.complete_subtask(state)

# è·å–å½“å‰ä»»åŠ¡
current_task = planner.get_current_task(state)

# æ£€æŸ¥æ˜¯å¦æœ‰çˆ¶ä»»åŠ¡
has_parent = planner.has_parent_task(state)

# è·å–å½“å‰æ·±åº¦
depth = planner.get_task_depth(state)
```

**ä»»åŠ¡ä¸Šä¸‹æ–‡ç»“æ„**ï¼š
```python
TaskContext {
    task_id: str           # å”¯ä¸€ä»»åŠ¡æ ‡è¯†
    parent_id: str | None  # çˆ¶ä»»åŠ¡ ID
    depth: int            # å½“å‰æ·±åº¦ï¼ˆ0 ä¸ºä¸»ä»»åŠ¡ï¼‰
    creation_timestamp: datetime
    task_data: Dict[str, Any]  # ä»»åŠ¡ç›¸å…³æ•°æ®
}
```

## æŠ€æœ¯æ ˆ

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **ç¼–æ’å¼•æ“**: LangGraphï¼ˆPythonï¼‰- çŠ¶æ€æœºç®¡ç†
- **æ•°æ®æ¨¡å‹**: Pydantic - ç±»å‹å®‰å…¨çš„æ•°æ®éªŒè¯
- **å¼‚æ­¥å¤„ç†**: asyncio - é«˜æ€§èƒ½å¼‚æ­¥ I/O

### LLM å’ŒåµŒå…¥
- **LLM æä¾›å•†**: 
  - OpenAIï¼ˆGPT-4oã€GPT-4o-miniï¼‰
  - é€šä¹‰åƒé—®ï¼ˆqwen-maxã€qwen-turboï¼‰
  - MiniMaxï¼ˆabab6.5-chatã€abab5.5-chatï¼‰
  - æ™ºè°± GLMï¼ˆglm-4ã€glm-3-turboï¼‰
- **åµŒå…¥æ¨¡å‹**: 
  - OpenAI text-embedding-3-large
  - é€šä¹‰åƒé—® text-embedding-v2
  - MiniMax embo-01
  - æ™ºè°± embedding-2

### æ•°æ®å­˜å‚¨ï¼ˆæ¸è¿›å¼æ¶æ„ï¼‰

**åˆæœŸæ¶æ„ï¼ˆMVP é˜¶æ®µï¼‰**ï¼š
- **å…³ç³»å‹æ•°æ®åº“**: PostgreSQL 17 + pgvectorï¼ˆç»Ÿä¸€æ•°æ®åº“ï¼‰
- **ç¼“å­˜**: Redis 7+ï¼ˆå•æœºæˆ–ä¸»ä»æ¨¡å¼ï¼‰
- **å¯¹è±¡å­˜å‚¨**: MinIOï¼ˆå•æœºï¼‰
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQï¼ˆå•æœºï¼‰

**æ‰©å±•æ¶æ„ï¼ˆè§„æ¨¡åŒ–é˜¶æ®µï¼‰**ï¼š
- **å‘é‡æ•°æ®åº“**: Milvusï¼ˆåˆ†å¸ƒå¼é›†ç¾¤ï¼‰
- **å…³ç³»å‹æ•°æ®åº“**: PostgreSQL é›†ç¾¤ï¼ˆä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»ï¼‰
- **ç¼“å­˜**: Redis Clusterï¼ˆé«˜å¯ç”¨é›†ç¾¤ï¼‰
- **å¯¹è±¡å­˜å‚¨**: MinIO é›†ç¾¤æˆ–äº‘å­˜å‚¨ï¼ˆS3/OSS/COSï¼‰

**è¿ç§»è§¦å‘æ¡ä»¶**ï¼š
- å‘é‡æ•°æ®é‡ > 100 ä¸‡æ¡
- å‘é‡æœç´¢ QPS > 100
- P99 å»¶è¿Ÿ > 500ms
- å­˜å‚¨å¤§å° > 100GB

### åŸºç¡€è®¾æ–½
- **ä»£ç è§£æ**: Tree-sitterï¼ˆå¤šè¯­è¨€æ”¯æŒï¼‰
- **ç›‘æ§**: Prometheus + Grafana
- **æ—¥å¿—**: ELK Stackï¼ˆElasticsearch + Logstash + Kibanaï¼‰
- **è¿½è¸ª**: Jaeger / OpenTelemetry
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **ç¼–æ’**: Kubernetesï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- **æµ‹è¯•**: Pytest + Hypothesisï¼ˆå±æ€§æµ‹è¯•ï¼‰

## å¿«é€Ÿå¼€å§‹

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.10+
- PostgreSQL 17ï¼ˆå¸¦ pgvector æ‰©å±•ï¼‰
- Redis 7+
- è‡³å°‘ä¸€ä¸ª LLM æä¾›å•†çš„ API å¯†é’¥

### 2. å®‰è£…ä¾èµ–

**ä½¿ç”¨ Poetryï¼ˆæ¨èï¼‰**ï¼š

```bash
# å®‰è£… Poetry
curl -sSL https://install.python-poetry.org | python3 -

# å®‰è£…é¡¹ç›®ä¾èµ–
poetry install
```

**ä½¿ç”¨ pip**ï¼š

```bash
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒ

1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š
```bash
cp .env.example .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½® API å¯†é’¥å’Œæ•°æ®åº“è¿æ¥ï¼š
```bash
# LLM æä¾›å•†é…ç½®
OPENAI_API_KEY=your_openai_key
QWEN_API_KEY=your_qwen_key
MINIMAX_API_KEY=your_minimax_key
GLM_API_KEY=your_glm_key

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost:5432/screenplay_db
REDIS_URL=redis://localhost:6379/0
```

3. è‡ªå®šä¹‰ `config.yaml` è¿›è¡Œé«˜çº§é…ç½®ï¼ˆå¯é€‰ï¼‰

### 4. æ•°æ®åº“åˆå§‹åŒ–

```bash
# åˆ›å»ºæ•°æ®åº“
createdb screenplay_db

# å¯ç”¨ pgvector æ‰©å±•
psql -d screenplay_db -c "CREATE EXTENSION vector;"

# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
psql -d screenplay_db -f scripts/init_db.sql
psql -d screenplay_db -f scripts/create_core_tables.sql
psql -d screenplay_db -f scripts/create_vector_tables.sql
psql -d screenplay_db -f scripts/create_log_tables.sql
psql -d screenplay_db -f scripts/create_functions.sql
psql -d screenplay_db -f scripts/performance_optimization.sql

# éªŒè¯è®¾ç½®
python scripts/verify_setup.py
```

### 5. ä½¿ç”¨ Docker Composeï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆPostgreSQLã€Redisã€MinIOï¼‰
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

## ä½¿ç”¨æ–¹æ³•

### CLI ä½¿ç”¨ï¼ˆå¼€å‘ä¸­ï¼‰

```bash
# åŸºæœ¬ç”¨æ³•
python -m src.presentation.cli \
    --topic "ç”¨æˆ·è®¤è¯ç³»ç»Ÿå®ç°" \
    --context "åŸºäº FastAPI å’Œ JWT çš„è®¤è¯ç³»ç»Ÿ"

# æŒ‡å®š Skill
python -m src.presentation.cli \
    --topic "å¤æ‚çš„å¾®æœåŠ¡æ¶æ„" \
    --skill visualization_analogy

# æŒ‡å®š LLM æä¾›å•†
python -m src.presentation.cli \
    --topic "æ•°æ®åº“ä¼˜åŒ–ç­–ç•¥" \
    --provider qwen
```

### API ä½¿ç”¨ï¼ˆå¼€å‘ä¸­ï¼‰

```bash
# å¯åŠ¨ API æœåŠ¡å™¨
python -m src.presentation.api

# å‘é€è¯·æ±‚
curl -X POST http://localhost:8000/api/v1/generate \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "Redis ç¼“å­˜ç­–ç•¥",
    "project_context": "é«˜å¹¶å‘ç”µå•†ç³»ç»Ÿ"
  }'
```

### Python API

```python
from src.application.orchestrator import WorkflowOrchestrator
from src.services.llm.service import LLMService
from src.services.retrieval_service import RetrievalService
from src.domain.models import SharedState

# åˆå§‹åŒ–æœåŠ¡
llm_service = LLMService.from_yaml("config/llm_providers.yaml")
retrieval_service = RetrievalService(...)

# åˆ›å»ºç¼–æ’å™¨
orchestrator = WorkflowOrchestrator(
    llm_service=llm_service,
    retrieval_service=retrieval_service,
)

# æ‰§è¡Œå·¥ä½œæµ
initial_state = SharedState(
    user_topic="åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†",
    project_context="å¾®æœåŠ¡æ¶æ„"
)

final_screenplay = await orchestrator.execute(initial_state)
print(final_screenplay)
```

## å¼€å‘æŒ‡å—

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# å•å…ƒæµ‹è¯•
pytest tests/unit/ -v

# å±æ€§æµ‹è¯•ï¼ˆåŸºäº Hypothesisï¼‰
pytest tests/property/ -v

# é›†æˆæµ‹è¯•
pytest tests/integration/ -v

# å¸¦è¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=src --cov-report=html --cov-report=term

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/property/test_graceful_component_failure.py -v
```

### ä»£ç è´¨é‡

```bash
# æ ¼å¼åŒ–ä»£ç 
black src/ tests/

# ä»£ç æ£€æŸ¥
ruff check src/ tests/

# ç±»å‹æ£€æŸ¥
mypy src/

# è¿è¡Œæ‰€æœ‰è´¨é‡æ£€æŸ¥
make lint  # å¦‚æœæœ‰ Makefile
```

### é¡¹ç›®ç»“æ„è¯´æ˜

è¯¦ç»†çš„é¡¹ç›®ç»“æ„è¯´æ˜è¯·å‚è€ƒï¼š
- [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md) - å®Œæ•´çš„ç›®å½•ç»“æ„
- [src/services/README.md](src/services/README.md) - æœåŠ¡å±‚è®¾è®¡
- [src/domain/README_SKILLS.md](src/domain/README_SKILLS.md) - Skill ç³»ç»Ÿè¯¦è§£

## æ€§èƒ½åŸºå‡†

ç³»ç»Ÿæ€§èƒ½ç›®æ ‡ï¼š

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| å•æ­¥éª¤å¤„ç†æ—¶é—´ | < 5s | åŒ…æ‹¬æ£€ç´¢ã€è¯„ä¼°ã€ç”Ÿæˆ |
| å®Œæ•´å‰§æœ¬ç”Ÿæˆæ—¶é—´ | < 60s | 10 æ­¥å¤§çº²çš„å®Œæ•´æµç¨‹ |
| RAG æ£€ç´¢å»¶è¿Ÿ | < 500ms | å‘é‡æœç´¢ + å…³é”®è¯æœç´¢ |
| LLM å“åº”å»¶è¿Ÿ | < 3s | å•æ¬¡ LLM è°ƒç”¨ |
| ç³»ç»Ÿååé‡ | > 100 req/min | å¹¶å‘è¯·æ±‚å¤„ç†èƒ½åŠ› |
| API å“åº”æ—¶é—´ï¼ˆP95ï¼‰ | < 2s | 95% çš„è¯·æ±‚åœ¨ 2 ç§’å†…å®Œæˆ |

## å•†ä¸šåŒ–ç‰¹æ€§

### å¯æ‰©å±•æ€§
- æ— çŠ¶æ€æ™ºèƒ½ä½“æœåŠ¡ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- æ•°æ®åº“åˆ†ç‰‡å’Œè¯»å†™åˆ†ç¦»
- è‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆKubernetes HPAï¼‰

### ç›‘æ§å’Œå¯è§‚æµ‹æ€§
- Prometheus æŒ‡æ ‡æ”¶é›†
- Grafana ä»ªè¡¨æ¿
- åˆ†å¸ƒå¼è¿½è¸ªï¼ˆJaegerï¼‰
- é›†ä¸­å¼æ—¥å¿—ï¼ˆELK Stackï¼‰

### å®‰å…¨æ€§
- JWT ä»¤ç‰Œè®¤è¯
- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
- ä¼ è¾“åŠ å¯†ï¼ˆTLSï¼‰
- é™æ€æ•°æ®åŠ å¯†
- API é€Ÿç‡é™åˆ¶

## éƒ¨ç½²

### å•æœºéƒ¨ç½²ï¼ˆå¼€å‘/æµ‹è¯•ï¼‰

```bash
# ä½¿ç”¨ Docker Compose
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f screenplay-app
```

### åˆ†å¸ƒå¼éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# ä½¿ç”¨ Kubernetes
kubectl apply -f k8s/namespace.yaml
kubectl apply -f k8s/configmap.yaml
kubectl apply -f k8s/secrets.yaml
kubectl apply -f k8s/deployment.yaml
kubectl apply -f k8s/service.yaml
kubectl apply -f k8s/ingress.yaml

# æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
kubectl get pods -n screenplay-system
kubectl get svc -n screenplay-system
```

è¯¦ç»†éƒ¨ç½²æŒ‡å—è¯·å‚è€ƒ [éƒ¨ç½²æ–‡æ¡£](docs/DEPLOYMENT.md)ï¼ˆå¾…æ·»åŠ ï¼‰ã€‚

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åˆ‡æ¢ LLM æä¾›å•†ï¼Ÿ

ç¼–è¾‘ `config/llm_providers.yaml`ï¼š
```yaml
active_provider: "qwen"  # æ”¹ä¸º qwenã€minimax æˆ– glm
fallback_providers: ["openai", "glm"]
```

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ Skillï¼Ÿ

1. åœ¨ `src/domain/skills.py` ä¸­æ·»åŠ  Skill å®šä¹‰
2. åœ¨ `src/domain/agents/writer.py` ä¸­æ·»åŠ  Skill æç¤ºæ¨¡æ¿
3. æ›´æ–° Skill å…¼å®¹æ€§è§„åˆ™
4. ç¼–å†™å•å…ƒæµ‹è¯•

### Q: å‘é‡æ•°æ®åº“ä½•æ—¶éœ€è¦è¿ç§»åˆ° Milvusï¼Ÿ

å½“æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶æ—¶ï¼š
- å‘é‡æ•°æ®é‡ > 100 ä¸‡æ¡
- å‘é‡æœç´¢ QPS > 100
- P99 å»¶è¿Ÿ > 500ms
- å­˜å‚¨å¤§å° > 100GB

### Q: å¦‚ä½•è°ƒè¯•æ™ºèƒ½ä½“æ‰§è¡Œæµç¨‹ï¼Ÿ

1. å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

2. æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—ï¼š
```python
print(state.execution_log)
```

3. ä½¿ç”¨ LangGraph å¯è§†åŒ–å·¥å…·ï¼ˆå¼€å‘ä¸­ï¼‰

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼ˆ`git checkout -b feature/AmazingFeature`ï¼‰
3. æäº¤æ›´æ”¹ï¼ˆ`git commit -m 'Add some AmazingFeature'`ï¼‰
4. æ¨é€åˆ°åˆ†æ”¯ï¼ˆ`git push origin feature/AmazingFeature`ï¼‰
5. å¼€å¯ Pull Request

è¯·ç¡®ä¿ï¼š
- æ‰€æœ‰æµ‹è¯•é€šè¿‡
- ä»£ç ç¬¦åˆ PEP 8 è§„èŒƒ
- æ·»åŠ å¿…è¦çš„æ–‡æ¡£å’Œæ³¨é‡Š
- æ›´æ–°ç›¸å…³çš„ README å’Œæ–‡æ¡£

## é¡¹ç›®çŠ¶æ€

æœ¬é¡¹ç›®æ­£åœ¨ç§¯æå¼€å‘ä¸­ã€‚å½“å‰è¿›åº¦ï¼š

- âœ… æ ¸å¿ƒæ¶æ„è®¾è®¡
- âœ… å…­å¤§æ™ºèƒ½ä½“å®ç°
- âœ… RAG æ··åˆæ£€ç´¢
- âœ… å¤š LLM æä¾›å•†æ”¯æŒ
- âœ… Skill ç³»ç»Ÿ
- âœ… äº‹å®æ£€æŸ¥æœºåˆ¶
- âœ… é”™è¯¯å¤„ç†å’Œä¼˜é›…é™çº§
- âœ… å±æ€§æµ‹è¯•ï¼ˆ27 ä¸ªå±æ€§ + 3 ä¸ªè¾¹ç•Œæƒ…å†µï¼‰
- ğŸš§ CLI å’Œ API æ¥å£ï¼ˆå¼€å‘ä¸­ï¼‰
- ğŸš§ ç›‘æ§å’Œå¯è§‚æµ‹æ€§ï¼ˆå¼€å‘ä¸­ï¼‰
- ğŸ“‹ Web UIï¼ˆè®¡åˆ’ä¸­ï¼‰
- ğŸ“‹ Milvus è¿ç§»å·¥å…·ï¼ˆè®¡åˆ’ä¸­ï¼‰

è¯¦ç»†è¿›åº¦è¯·æŸ¥çœ‹ [ä»»åŠ¡åˆ—è¡¨](.kiro/specs/rag-screenplay-multi-agent/tasks.md)ã€‚

## è®¸å¯è¯

[MIT License](LICENSE)

## è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µï¼š[GitHub Repository URL]
- é—®é¢˜åé¦ˆï¼š[GitHub Issues URL]
- æ–‡æ¡£ï¼š[Documentation URL]

## è‡´è°¢

æœ¬é¡¹ç›®ä½¿ç”¨äº†ä»¥ä¸‹ä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼š
- [LangGraph](https://github.com/langchain-ai/langgraph) - çŠ¶æ€æœºç¼–æ’
- [Hypothesis](https://hypothesis.readthedocs.io/) - å±æ€§æµ‹è¯•æ¡†æ¶
- [pgvector](https://github.com/pgvector/pgvector) - PostgreSQL å‘é‡æ‰©å±•
- [Tree-sitter](https://tree-sitter.github.io/) - ä»£ç è§£æ
- [FastAPI](https://fastapi.tiangolo.com/) - Web æ¡†æ¶ï¼ˆè®¡åˆ’ä½¿ç”¨ï¼‰

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…çš„è¾›å‹¤å·¥ä½œï¼
